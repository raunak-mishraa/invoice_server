import { Request, Response } from "express";
import puppeteer from "puppeteer";
import fs from "fs";
import path from "path";
import mongoose from "mongoose";

// Type for product data
type ProData = {
  productname: string;
  productprice: number;
  productquantity: number;
  totalprice: number;
};
export const createPDF = async (req: Request, res: Response): Promise<void> => {
  const data: ProData[] = req.body;

  // Validate input data
  if (!data || data.length === 0) {
    res.status(400).send("No data provided");
    return;
  }

  const db = mongoose.connection.db;
 
  // @ts-ignore
  await db.collection("invoices").insertOne(data);

  // Prepare the HTML content for the PDF
  const itemsHtml = data
    .map((item, index) => {
      const isEven = index % 2 === 1; // Check if the index is even (every second item)
      return ` 
        <div style="display: flex;  padding: 10px 0; 
                    background-color: ${isEven ? "#f0f0f0" : "transparent"}; 
                    border-radius: ${isEven ? "10px" : "0"};">
          <div style="flex: 1; text-align: left; padding: 0 15px;">${
            item.productname
          }</div>
          <div style="flex: 1; text-align: left; padding: 0 10px;">${
            item.productquantity
          }</div>
          <div style="flex: 1; text-align: left; padding: 0 10px;">${
            item.productprice
          }</div>
          <div style="flex: 1; text-align: left; padding: 0 10px;">${
            item.totalprice
          }</div>
        </div>`;
    })
    .join("");

  const totalAmount = data.reduce((acc, item) => acc + item.totalprice, 0);
  const gst = totalAmount * 0.18; // Example GST calculation
  const finalAmount = totalAmount + gst;

  const invoiceHtml = `
    <html>
      <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Invoice</title>
        <style>
          body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #fff;
            color: #333;
          }
          .invoice-container {
            max-width: 800px;
            margin: 20px auto;
            background: #fff;
            padding: 20px;
          
          }
          .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
          }
          .header h1 {
            font-size: 24px;
            color: #555;
          }
          .header .date {
            text-align: right;
            font-size: 14px;
            color: #777;
          }
          .customer-info,
          .footer {
            margin-top: 20px;
          }
          .items {
            margin-top: 20px;
          }
          table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
          }
          th,
          td {
            padding: 10px;
            text-align: left;
            border: 1px solid #ddd;
          }
          th {
            background-color: #f4f4f4;
          }
          .footer {
            text-align: center;
            font-size: 12px;
            color: #888;
          }
        </style>
      </head>
      <body>
        <div class="invoice-container">
          <div class="header" style="border-bottom: 0.5px solid gray">
            <div style="width: 100%; display: flex; justify-content: space-between">
            <svg xmlns="http://www.w3.org/2000/svg" width="141" height="48" viewBox="0 0 141 48" fill="none"><path d="M39 24L29.5 43.5H25H9.80385L5.53038 35L0 24L9.5 4.5H14H29.5L33.641 13L39 24Z" fill="black"></path><path d="M25 35L30.5 24L25 13L34 24L25 35Z" fill="white"></path><path d="M12.5 15L14 13L8.5 24L14 35L5.5 24L12.5 15Z" fill="white"></path><path d="M53.2871 24.2051C52.5254 24.2051 51.9264 23.9902 51.4902 23.5605C51.054 23.1243 50.8359 22.4766 50.8359 21.6172V8.90234H52.4277V21.5098C52.4277 21.959 52.5124 22.2845 52.6816 22.4863C52.8574 22.6816 53.1276 22.7793 53.4922 22.7793C53.7135 22.7793 53.9382 22.7435 54.166 22.6719L54.3027 22.7109L54.4883 23.9609C54.3711 24.0391 54.2018 24.0977 53.9805 24.1367C53.7656 24.1823 53.5345 24.2051 53.2871 24.2051ZM65.123 18.9805H57.7207C57.7663 20.2891 58.0788 21.2493 58.6582 21.8613C59.2441 22.4733 60.0449 22.7793 61.0605 22.7793C61.8288 22.7793 62.4473 22.6426 62.916 22.3691C63.3848 22.0957 63.7526 21.666 64.0195 21.0801H64.2246L65.2598 21.6953C64.9473 22.4766 64.446 23.0918 63.7559 23.541C63.0723 23.9837 62.1738 24.2051 61.0605 24.2051C60.0189 24.2051 59.1237 24 58.375 23.5898C57.6263 23.1797 57.0501 22.5579 56.6465 21.7246C56.2428 20.8913 56.041 19.8561 56.041 18.6191C56.041 17.3952 56.2526 16.3633 56.6758 15.5234C57.1055 14.6836 57.6882 14.0586 58.4238 13.6484C59.166 13.2318 60.0124 13.0234 60.9629 13.0234C62.3431 13.0234 63.4206 13.4141 64.1953 14.1953C64.9701 14.9701 65.3607 16.1224 65.3672 17.6523C65.3672 18.2513 65.3542 18.6549 65.3281 18.8633L65.123 18.9805ZM63.7949 17.6523C63.7689 16.5065 63.515 15.6732 63.0332 15.1523C62.5514 14.6315 61.8613 14.3711 60.9629 14.3711C60.0189 14.3711 59.2767 14.6348 58.7363 15.1621C58.2025 15.6829 57.877 16.513 57.7598 17.6523H63.7949ZM73.1602 24H70.9727L66.8711 13.2285H68.5898L71.9785 22.1836H72.2031L75.5625 13.2285H77.2422L73.1602 24ZM80.4453 11.1484C80.1068 11.1484 79.8301 11.0443 79.6152 10.8359C79.4069 10.6211 79.3027 10.3509 79.3027 10.0254C79.3027 9.69987 79.4069 9.43294 79.6152 9.22461C79.8301 9.00977 80.1068 8.90234 80.4453 8.90234C80.7839 8.90234 81.0573 9.00977 81.2656 9.22461C81.4805 9.43294 81.5879 9.69987 81.5879 10.0254C81.5879 10.3509 81.4805 10.6211 81.2656 10.8359C81.0573 11.0443 80.7839 11.1484 80.4453 11.1484ZM79.6445 24V13.2285H81.2363V24H79.6445ZM90.4062 22.291L90.9141 23.4336C90.6602 23.6875 90.3249 23.8796 89.9082 24.0098C89.498 24.14 89.0521 24.2051 88.5703 24.2051C86.513 24.2051 85.4844 23.1634 85.4844 21.0801V14.5273H83.6094V13.2188H85.4844V10.9434L87.0762 10.6797V13.2188H90.543V14.5273H87.0762V20.9238C87.0762 22.1608 87.6133 22.7793 88.6875 22.7793C89.2734 22.7793 89.778 22.6165 90.2012 22.291H90.4062ZM95.7676 24.2051C94.7064 24.2051 93.8763 23.9284 93.2773 23.375C92.6849 22.8216 92.3887 22.0306 92.3887 21.002C92.3887 20.3639 92.5189 19.8268 92.7793 19.3906C93.0462 18.9479 93.4564 18.5898 94.0098 18.3164C94.5632 18.0365 95.2858 17.8216 96.1777 17.6719C96.959 17.5417 97.5514 17.3952 97.9551 17.2324C98.3652 17.0697 98.6387 16.8874 98.7754 16.6855C98.9186 16.4837 98.9902 16.2298 98.9902 15.9238C98.9902 15.4355 98.821 15.0612 98.4824 14.8008C98.1504 14.5404 97.6133 14.4102 96.8711 14.4102C96.1745 14.4102 95.5755 14.5469 95.0742 14.8203C94.5794 15.0872 94.1237 15.4876 93.707 16.0215H93.5117L92.7305 14.918C93.1862 14.3385 93.7656 13.8796 94.4688 13.541C95.1719 13.196 95.9727 13.0234 96.8711 13.0234C98.1406 13.0234 99.0749 13.3034 99.6738 13.8633C100.279 14.4167 100.582 15.1849 100.582 16.168V21.8809C100.582 22.4798 100.836 22.7793 101.344 22.7793C101.513 22.7793 101.676 22.75 101.832 22.6914L101.969 22.7305L102.154 23.834C102.037 23.9121 101.881 23.9707 101.686 24.0098C101.497 24.0553 101.301 24.0781 101.1 24.0781C100.507 24.0781 100.058 23.9479 99.752 23.6875C99.4525 23.4271 99.2604 23.043 99.1758 22.5352L98.9707 22.5156C98.6647 23.082 98.2513 23.5052 97.7305 23.7852C97.2096 24.0651 96.5553 24.2051 95.7676 24.2051ZM96.1191 22.9355C96.7181 22.9355 97.2357 22.7988 97.6719 22.5254C98.1146 22.2454 98.4531 21.8548 98.6875 21.3535C98.9219 20.8522 99.0391 20.2728 99.0391 19.6152V18.248L98.8535 18.209C98.6126 18.3783 98.3197 18.5215 97.9746 18.6387C97.6296 18.7493 97.1478 18.8503 96.5293 18.9414C95.9043 19.026 95.4062 19.1562 95.0352 19.332C94.6706 19.5078 94.4102 19.7324 94.2539 20.0059C94.0977 20.2728 94.0195 20.6048 94.0195 21.002C94.0195 21.6335 94.2051 22.1152 94.5762 22.4473C94.9473 22.7728 95.4616 22.9355 96.1191 22.9355ZM109.625 22.291L110.133 23.4336C109.879 23.6875 109.544 23.8796 109.127 24.0098C108.717 24.14 108.271 24.2051 107.789 24.2051C105.732 24.2051 104.703 23.1634 104.703 21.0801V14.5273H102.828V13.2188H104.703V10.9434L106.295 10.6797V13.2188H109.762V14.5273H106.295V20.9238C106.295 22.1608 106.832 22.7793 107.906 22.7793C108.492 22.7793 108.997 22.6165 109.42 22.291H109.625ZM113.219 11.1484C112.88 11.1484 112.604 11.0443 112.389 10.8359C112.18 10.6211 112.076 10.3509 112.076 10.0254C112.076 9.69987 112.18 9.43294 112.389 9.22461C112.604 9.00977 112.88 8.90234 113.219 8.90234C113.557 8.90234 113.831 9.00977 114.039 9.22461C114.254 9.43294 114.361 9.69987 114.361 10.0254C114.361 10.3509 114.254 10.6211 114.039 10.8359C113.831 11.0443 113.557 11.1484 113.219 11.1484ZM112.418 24V13.2285H114.01V24H112.418ZM122.076 24.2051C121.061 24.2051 120.175 23.9902 119.42 23.5605C118.671 23.1309 118.092 22.4993 117.682 21.666C117.278 20.8262 117.076 19.8105 117.076 18.6191C117.076 17.4277 117.278 16.4121 117.682 15.5723C118.092 14.7324 118.671 14.0977 119.42 13.668C120.175 13.2383 121.061 13.0234 122.076 13.0234C123.092 13.0234 123.974 13.2383 124.723 13.668C125.478 14.0977 126.057 14.7324 126.461 15.5723C126.871 16.4121 127.076 17.4277 127.076 18.6191C127.076 19.8105 126.871 20.8262 126.461 21.666C126.057 22.4993 125.478 23.1309 124.723 23.5605C123.974 23.9902 123.092 24.2051 122.076 24.2051ZM122.076 22.7793C123.15 22.7793 123.971 22.4408 124.537 21.7637C125.11 21.0866 125.396 20.0384 125.396 18.6191C125.396 17.1934 125.11 16.1419 124.537 15.4648C123.971 14.7878 123.15 14.4492 122.076 14.4492C121.002 14.4492 120.178 14.791 119.605 15.4746C119.033 16.1517 118.746 17.1999 118.746 18.6191C118.746 20.0384 119.033 21.0866 119.605 21.7637C120.178 22.4408 121.002 22.7793 122.076 22.7793ZM130.133 24V13.2285H131.646V14.918L131.852 14.9668C132.21 14.3353 132.665 13.8535 133.219 13.5215C133.779 13.1895 134.459 13.0234 135.26 13.0234C136.555 13.0234 137.493 13.3555 138.072 14.0195C138.658 14.6771 138.951 15.6927 138.951 17.0664V24H137.359V17.1055C137.359 16.4544 137.275 15.9336 137.105 15.543C136.943 15.1458 136.686 14.8594 136.334 14.6836C135.989 14.5013 135.533 14.4102 134.967 14.4102C133.997 14.4102 133.212 14.7324 132.613 15.377C132.021 16.015 131.725 17.0469 131.725 18.4727V24H130.133Z" fill="black"></path><path d="M50.3379 37.5742C50.1686 37.5742 50.0303 37.5221 49.9229 37.418C49.8187 37.3105 49.7666 37.1755 49.7666 37.0127C49.7666 36.8499 49.8187 36.7165 49.9229 36.6123C50.0303 36.5049 50.1686 36.4512 50.3379 36.4512C50.5072 36.4512 50.6439 36.5049 50.748 36.6123C50.8555 36.7165 50.9092 36.8499 50.9092 37.0127C50.9092 37.1755 50.8555 37.3105 50.748 37.418C50.6439 37.5221 50.5072 37.5742 50.3379 37.5742ZM49.9375 44V38.6143H50.7334V44H49.9375ZM52.6133 44V38.6143H53.3701V39.459L53.4727 39.4834C53.6517 39.1676 53.8796 38.9268 54.1562 38.7607C54.4362 38.5947 54.7764 38.5117 55.1768 38.5117C55.8245 38.5117 56.2933 38.6777 56.583 39.0098C56.876 39.3385 57.0225 39.8464 57.0225 40.5332V44H56.2266V40.5527C56.2266 40.2272 56.1842 39.9668 56.0996 39.7715C56.0182 39.5729 55.8896 39.4297 55.7139 39.3418C55.5413 39.2507 55.3135 39.2051 55.0303 39.2051C54.5452 39.2051 54.153 39.3662 53.8535 39.6885C53.5573 40.0075 53.4092 40.5234 53.4092 41.2363V44H52.6133ZM59.0391 44V39.2637H58.1016V38.6094H59.0391C58.9805 38.375 58.9512 38.152 58.9512 37.9404C58.9512 37.5921 59.0244 37.2992 59.1709 37.0615C59.3206 36.8206 59.5273 36.6416 59.791 36.5244C60.0547 36.4072 60.359 36.3486 60.7041 36.3486C61.2412 36.3486 61.653 36.4642 61.9395 36.6953L61.6318 37.2568L61.5293 37.2764C61.3177 37.1071 61.0426 37.0225 60.7041 37.0225C60.3883 37.0225 60.1491 37.1038 59.9863 37.2666C59.8268 37.4294 59.7471 37.6605 59.7471 37.96C59.7471 38.1455 59.7764 38.362 59.835 38.6094H61.5488V39.2637H59.835V44H59.0391ZM64.6982 44.1025C64.1904 44.1025 63.7477 43.9951 63.3701 43.7803C62.9958 43.5654 62.7061 43.2497 62.501 42.833C62.2992 42.4131 62.1982 41.9053 62.1982 41.3096C62.1982 40.7139 62.2992 40.2061 62.501 39.7861C62.7061 39.3662 62.9958 39.0488 63.3701 38.834C63.7477 38.6191 64.1904 38.5117 64.6982 38.5117C65.2061 38.5117 65.6471 38.6191 66.0215 38.834C66.3991 39.0488 66.6888 39.3662 66.8906 39.7861C67.0957 40.2061 67.1982 40.7139 67.1982 41.3096C67.1982 41.9053 67.0957 42.4131 66.8906 42.833C66.6888 43.2497 66.3991 43.5654 66.0215 43.7803C65.6471 43.9951 65.2061 44.1025 64.6982 44.1025ZM64.6982 43.3896C65.2354 43.3896 65.6455 43.2204 65.9287 42.8818C66.2152 42.5433 66.3584 42.0192 66.3584 41.3096C66.3584 40.5967 66.2152 40.071 65.9287 39.7324C65.6455 39.3939 65.2354 39.2246 64.6982 39.2246C64.1611 39.2246 63.7493 39.3955 63.4629 39.7373C63.1764 40.0758 63.0332 40.5999 63.0332 41.3096C63.0332 42.0192 63.1764 42.5433 63.4629 42.8818C63.7493 43.2204 64.1611 43.3896 64.6982 43.3896ZM71.4316 43.1455L71.6855 43.7168C71.5586 43.8438 71.391 43.9398 71.1826 44.0049C70.9775 44.07 70.7546 44.1025 70.5137 44.1025C69.485 44.1025 68.9707 43.5817 68.9707 42.54V39.2637H68.0332V38.6094H68.9707V37.4717L69.7666 37.3398V38.6094H71.5V39.2637H69.7666V42.4619C69.7666 43.0804 70.0352 43.3896 70.5723 43.3896C70.8652 43.3896 71.1175 43.3083 71.3291 43.1455H71.4316ZM76.9541 41.4902H73.2529C73.2757 42.1445 73.432 42.6247 73.7217 42.9307C74.0146 43.2367 74.415 43.3896 74.9229 43.3896C75.307 43.3896 75.6162 43.3213 75.8506 43.1846C76.085 43.0479 76.2689 42.833 76.4023 42.54H76.5049L77.0225 42.8477C76.8662 43.2383 76.6156 43.5459 76.2705 43.7705C75.9287 43.9919 75.4795 44.1025 74.9229 44.1025C74.402 44.1025 73.9544 44 73.5801 43.7949C73.2057 43.5898 72.9176 43.279 72.7158 42.8623C72.514 42.4456 72.4131 41.9281 72.4131 41.3096C72.4131 40.6976 72.5189 40.1816 72.7305 39.7617C72.9453 39.3418 73.2367 39.0293 73.6045 38.8242C73.9756 38.6159 74.3988 38.5117 74.874 38.5117C75.5641 38.5117 76.1029 38.707 76.4902 39.0977C76.8776 39.485 77.0729 40.0612 77.0762 40.8262C77.0762 41.1257 77.0697 41.3275 77.0566 41.4316L76.9541 41.4902ZM76.29 40.8262C76.277 40.2533 76.1501 39.8366 75.9092 39.5762C75.6683 39.3158 75.3232 39.1855 74.874 39.1855C74.402 39.1855 74.0309 39.3174 73.7607 39.5811C73.4938 39.8415 73.3311 40.2565 73.2725 40.8262H76.29ZM80.6553 44.1025C80.18 44.1025 79.7536 43.9951 79.376 43.7803C78.9984 43.5622 78.7005 43.2432 78.4824 42.8232C78.2643 42.4001 78.1553 41.8955 78.1553 41.3096C78.1553 40.7204 78.2643 40.2158 78.4824 39.7959C78.7005 39.3727 78.9984 39.0537 79.376 38.8389C79.7536 38.6208 80.18 38.5117 80.6553 38.5117C81.2249 38.5117 81.6774 38.6191 82.0127 38.834C82.3512 39.0488 82.5954 39.3353 82.7451 39.6934L82.2031 40.084H82.1055C81.959 39.7878 81.7702 39.5713 81.5391 39.4346C81.3112 39.2946 81.0166 39.2246 80.6553 39.2246C80.3232 39.2246 80.0319 39.3027 79.7812 39.459C79.5306 39.6152 79.3353 39.8496 79.1953 40.1621C79.0586 40.4746 78.9902 40.8571 78.9902 41.3096C78.9902 41.7588 79.0602 42.1396 79.2002 42.4521C79.3402 42.7614 79.5339 42.9958 79.7812 43.1553C80.0319 43.3115 80.3232 43.3896 80.6553 43.3896C81.0296 43.3896 81.3389 43.305 81.583 43.1357C81.8304 42.9665 82.0241 42.6995 82.1641 42.335H82.2666L82.7891 42.6426C82.6491 43.0951 82.3984 43.4515 82.0371 43.7119C81.679 43.9723 81.2184 44.1025 80.6553 44.1025ZM84.0586 44V36.4512H84.8545V39.3809L84.957 39.4004C85.3411 38.8079 85.8962 38.5117 86.6221 38.5117C87.2699 38.5117 87.7386 38.6777 88.0283 39.0098C88.3213 39.3385 88.4678 39.8464 88.4678 40.5332V44H87.6719V40.5527C87.6719 40.2272 87.6296 39.9668 87.5449 39.7715C87.4635 39.5729 87.335 39.4297 87.1592 39.3418C86.9867 39.2507 86.7588 39.2051 86.4756 39.2051C85.9873 39.2051 85.5951 39.363 85.2988 39.6787C85.0026 39.9945 84.8545 40.5137 84.8545 41.2363V44H84.0586Z" fill="black"></path></svg>
              <p>Invoice Generator</p>
            </div>
          </div>
          <div
            class="customer-info"
            style="
              background: linear-gradient(to right, #1d2032, #151618, #1e2135);
              width: 90%;
              padding: 5%;
              display: flex;
              justify-content: space-between;
              border-radius: 20px;
            "
          >
            <div>
              <p style="color: #cccccc">Name</p>
        
              <p style="color: #ccf575; font-size: 20px;">Person_name</p>

            </div>
            <div class="date">
              <p style="text-align: right; color: #cccccc">Date: ${new Date().toLocaleDateString()}</p>
              <div
                style="
                  background-color: #fff;
                  border-radius: 10px;
                  width: 100%;
                  display: grid;
                  place-content: center;
                  padding: 5px;
                  margin-left: auto;
                "
              >
                example@email.com
              </div>
            </div>
          </div>
          <div class="items">
        <table>
          <div
            style="
              display: flex;
              background: linear-gradient(to right, #303060, #283517);
              border-radius: 20px;
              overflow: hidden;
              padding: 10px 0;
            "
          >
            <div
              style="
                flex: 1; /* Each column takes equal width */
                text-align: left;
                color: white;
                padding: 5px 5px 5px 15px;
              "
            >
              Product
            </div>
            <div style="flex: 1; text-align: left; color: white; padding: 5px">
              Qty
            </div>
            <div style="flex: 1; text-align: left; color: white; padding: 5px">
              Rate
            </div>
            <div style="flex: 1; text-align: left; color: white; padding: 5px">
              Total
            </div>
          </div>

          <tbody>
            ${itemsHtml}
          </tbody>
        </table>
      </div>
          <div
        class="summary"
        style="
          padding: 2%;
          border: 1px solid black;
          width: 35%;
          text-align: right;
          border-radius: 10px;
          margin-left: auto;
          margin-top: 5vh;
          display: flex;
          justify-content: space-between;

        "
      >
        <div>
          <p style="color: #aca9a9">Total Charges</p>
          <p style="color: #aca9a9"; text-align: left;>GST (18%)</p>
          <p style="font-weight: bold" class="total">Total Amount</p>
        </div>
        <div>
          <p>₹${totalAmount.toFixed(2)}</p>
          <p>₹${gst.toFixed(2)}</p>
          <p style="color: #175ee2">₹${finalAmount.toFixed(2)}</p>
        </div>
      </div>

          <p style="text-align: left; color:rgb(141, 140, 140)">Date: ${new Date().toLocaleDateString()}</p>
          
          <div class="footer" style="background-color: #272833; padding: 1% 5% 1% 5%; color: #cccccc; text-align: center; border-radius: 40px; width: 70%;margin-left : 10% ; margin-top : 5vh">
            <p>
              We are pleased to provide any further information you may require and
              look forward to assisting with your next order. Rest assured, it will
              receive our prompt and dedicated attention.
            </p>
          </div>
        </div>
      </body>
    </html>
  `;

  try {
    // Launch Puppeteer to generate the PDF
    const browser = await puppeteer.launch({ headless: true });
    const page = await browser.newPage();
    await page.setContent(invoiceHtml);
    const pdfBuffer = await page.pdf({ format: "A4", printBackground: true }); // Enable background rendering

    // Define the path to save the PDF on the server
    const pdfPath = path.join(__dirname, "pdfs", `invoice-${Date.now()}.pdf`);

    // Ensure the directory exists, create if it doesn't
    const dirPath = path.dirname(pdfPath);
    if (!fs.existsSync(dirPath)) {
      fs.mkdirSync(dirPath, { recursive: true });
    }

    // Save the PDF buffer to the file system
    fs.writeFileSync(pdfPath, pdfBuffer);

    await browser.close();

    // Log the saved file path for debugging purposes
    console.log(`PDF saved at ${pdfPath}`);

    // Optionally send success response
    res.status(200).json({
      path: pdfPath,
    });
  } catch (error) {
    console.error("Error generating PDF:", error);
    res.status(500).send("Error generating PDF");
  }
};

export const downloadPDF = async (
  req: Request,
  res: Response
): Promise<void> => {
  try {
    const { path: filePath } = req.body; // Rename the destructured variable to avoid conflict
    console.log("Requested file:", filePath);

    if (!filePath || typeof filePath !== "string") {
      res.status(400).send("Invalid file name");
      return;
    }

    if (!fs.existsSync(filePath)) {
      res.status(404).send("File not found");
      return;
    }

    // Stream the file to the client
    res.setHeader("Content-Disposition", `attachment; filename=${filePath}`);
    res.setHeader("Content-Type", "application/pdf");
    const fileStream = fs.createReadStream(filePath);
    fileStream.pipe(res);
  } catch (error) {
    console.error("Error handling PDF download:", error);
    res.status(500).send("Internal server error");
  }
};
